<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../ps-image-service/ps-image-service.html">
<link rel="import" href="../ps-gallery-service/ps-gallery-service.html">
<!--
Element displaying a PhotoShelter.com image.

##### Example

    <ps-image></ps-image>

@element ps-image
@blurb Element displaying a PhotoShelter.com image.
@status alpha
@homepage #
-->

<polymer-element name="ps-image" attributes="image I_ID G_ID size relativeSize sizeType">
  <template>
    <style>
    :host {
      display: block;
    }
    img {
      vertical-align: middle;
    }
    .relative {
      width: 100%;
      height: auto;
    }
    </style>

    <template if="{{!!I_ID}}">
      <ps-image-service id="service-image-link-{{I_ID}}" image="{{image}}" I_ID='{{I_ID}}' extends="{{imageExtends}}"></ps-image-service>
    </template>

    <template if="{{!!G_ID}}">
      <ps-gallery-service id="service-image-link-{{G_ID}}" image="{{image}}" G_ID='{{G_ID}}' extends="{{galleryExtends}}"></ps-gallery-service>
    </template>

    <template if="{{!!image && !!image.ImageLink}}">
      <img src="{{image.ImageLink.base}}/{{I_ID}}/sec={{image.ImageLink.token}}/{{sizeType}}={{size}}" width="{{width}}" height="{{height}}" class="{{aspectRatio}}" title="{{image.Iptc.title}}"/>
    </template>

  </template>

  <script>
  Polymer('ps-image', {
    /**
     * The `I_ID` attribute is the image_id to be displayed.
     *
     * @attribute I_ID
     * @type string
     * @default ''
     */
    I_ID: '',
    /**
     * The `sizeType` attribute is the size type for the img-get2 request
     *
     * @attribute sizeType
     * @type string
     * @default 'fit'
     */
    sizeType: 'fit',
    /**
     * The `size` attribute is the fit of the img-get2 URL to be requested
     *
     * @attribute size
     * @type string
     * @default '250x250'
     */
    size: '350x350',
    /**
     * The `width` attribute is the screen width of the displayed image.
     *
     * @attribute width
     * @type number
     * @default 250
     */
    width: 350,
    /**
     * The `height` attribute is the screen height of the displayed image.
     *
     * @attribute height
     * @type number
     * @default 250
     */
    height: 350,
    /**
     * The `aspectRatio` attribute is the aspect ratio that the image displays at.
     *
     * @attribute aspectRatio
     * @type string
     * @default 'landscape'
     */
    aspectRatio: 'landscape',
    created: function() {
      /**
       * The `image` attribute defines the PhotoShelter image to be displayed.
       *
       * @attribute image
       * @type object
       * @default {}
       */
      this.image = {};
      /**
       * The `imageExtends` attribute outlines the extends of the ps-image-service tag to support the content delivered.
       *
       * @attribute imageExtends
       * @type array
       * @default ["ImageLink"]
       */
      this.imageExtends = [
        "ImageLink"
      ];
      /**
       * The `galleryExtends` attribute outlines the extends of the ps-gallery-service tag to support the content delivered.
       *
       * @attribute galleryExtends
       * @type array
       * @default ["KeyImage", "Image"]
       */
      this.galleryExtends = [
        "KeyImage",
        "Image",
        "ImageLink"
      ];
    },
    /**
    * The `makeSize` method mutates width, height and size in relation to the image in question.
    *
    * @method makeSize
    */
    makeSize: function(size) {
      var iWidth = this.image.screen_width_max || this.image.Image.screen_width_max,
        iHeight = this.image.screen_height_max || this.image.Image.screen_height_max;
      if (typeof size === 'undefined') {
        if (iWidth > iHeight) {
          this.width = 400;
        } else {
          this.width = 200;
        }
        this.height = iHeight / iWidth * this.width;
        this.height = Math.floor(this.height);
      }
      if (this.height > this.width) this.aspectRatio = 'portrait';
      if (this.relativeSize === "true") this.aspectRatio += ' relative';
      this.size = this.width + 'x' + this.height;
    },
    /**
    * The `relativeSizeChanged` method append relative to image[class].
    *
    * @method relativeSizeChanged
    */
    relativeSizeChanged: function() {
      if (this.relativeSize === "true") this.aspectRatio += ' relative';
    }
  });
  </script>
</polymer-element>

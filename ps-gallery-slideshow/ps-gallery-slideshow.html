<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../ps-image-service/ps-image-service.html">
<link rel="import" href="../ps-user-service/ps-user-service.html">
<link rel="import" href="../ps-image-bkg/ps-image-bkg.html">
<link rel="import" href="../ps-image-iptc/ps-image-iptc.html">
<link rel="import" href="../ps-share/ps-share.html">
<link rel="import" href="../ps-image-exif/ps-image-exif.html">
<link rel="import" href="../ps-image-buy/ps-image-buy.html">
<!--
Element displaying a PhotoShelter.com image and any of it's associated data.

##### Example

    <ps-image-card></ps-image-card>

@element ps-image-card
@blurb Element displaying a PhotoShelter.com image and any of it's associated data.
@status alpha
@homepage #
-->

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="../vendor/jquery-2.1.0.min.js"><\/script>')</script>
<script src="../vendor/nanoScroller.0.8.0.min.js"></script>

<polymer-element name="ps-image-card" attributes="I_ID image">
  <template>
    <style>
    :host {
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      color: #fff;
      font-size: 12px;
      font-weight: 300;
      overflow: hidden;
    }
    *, *:before, *:after {
      -webkit-box-sizing: inherit;
      -moz-box-sizing: inherit;
      box-sizing: inherit;
    }
    h1 {
      font-size: 2em;
    }
    ps-image-bkg {
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      -webkit-transition-property: right;
      -moz-transition-property: right;
      -o-transition-property: right;
      transition-property: right;
      -webkit-transition-duration: 0.5s;
      -moz-transition-duration: 0.5s;
      -o-transition-duration: 0.5s;
      transition-duration: 0.5s;
    }
    .tray:not([data-offscreen]) + ps-image-bkg {
      right: 350px;
    }
    a {
      color: #F2AFAF;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    button {
      -webkit-appearance: none;
      border: none;
      line-height: inherit;
      outline: none;
      padding: 0;
      text-decoration: none;
      cursor: pointer;
      background: transparent;
      color: #fff;
    }
    button:after {
      line-height: inherit;
      font-size: 1.5em;
      font-family: 'icon-set';
    }
    .tray {
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      width: 100%;
      max-width: 350px;
      background: rgba(0, 0, 0, 0.55);
      -webkit-transition-property: all;
      -moz-transition-property: all;
      -o-transition-property: all;
      transition-property: all;
      -webkit-transition-duration: 0.5s;
      -moz-transition-duration: 0.5s;
      -o-transition-duration: 0.5s;
      transition-duration: 0.5s;
    }
    .tray[data-offscreen] {
      -webkit-transform: translate3d(100%, 0, 0);
      -moz-transform: translate3d(100%, 0, 0);
      -ms-transform: translate3d(100%, 0, 0);
      -o-transform: translate3d(100%, 0, 0);
      transform: translate3d(100%, 0, 0);
    }
    .tray > article {
      position: absolute;
      top: 0;
      right: 4em;
      bottom: 0;
      left: 0;
      width: auto;
      background: rgba(0, 0, 0, 0.55);
    }
    .nano-content {
      top: 4em;
      bottom: 4em;
      padding: 0 4.5em 0 3em
    }
    .tray > nav {
      position: absolute;
      right: 0;
      bottom: 4em;
      width: 4em;
    }
    nav > button {
      float: left;
      width: 4em;
      height: 4em;
      line-height: 4em;
      font-size: inherit;
      position: relative;
    }
    nav > button:after {
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      line-height: inherit;
      text-align: center;
    }
    nav > button:hover {
      background: rgba(0, 0, 0, 0.65);
    }

    [data-tab=iptc].iptc,
    [data-tab=share].share,
    [data-tab=exif].exif,
    [data-tab=buy].buy {
      background: rgba(0, 0, 0, 0.55);
    }
    [data-tab=iptc]:after {
      content: 'Q';
    }
    [data-tab=share]:after {
      content: '8 ';
    }
    [data-tab=exif]:after {
      content: '\0152';
    }
    [data-tab=buy]:after {
      content: 'i';
    }
    .toggle {
      position: absolute;
      right: 0;
      bottom: 0;
      width: 4em;
      height: 4em;
      line-height: 4em;
      font-size: inherit;
      cursor: pointer;
    }
    .toggle:after {
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      line-height: inherit;
      text-align: center;
      content: 'a';
    }
    .tray[data-offscreen] ~ .toggle:after {
      content: 'Q';
    }
    .tray[data-offscreen] ~ .toggle {
      background: rgba(0, 0, 0, 0.55);
    }
    .toggle:hover:after {
      background: rgba(0, 0, 0, 0.6);
    }
    /** initial setup **/
    .nano {
      position : relative;
      width    : auto;
      height   : 100%;
      overflow : hidden;
    }
    .nano > .nano-content {
      position      : absolute;
      overflow      : scroll;
      overflow-x    : hidden;
      top           : 4em;
      right         : 0;
      bottom        : 4em;
      left          : 0;
    }
/*    .nano:before {
      content: '';
      position: absolute;
      z-index: 2;
      top: 4em;
      left: 0;
      right: 4.5em;
      height: 20px;
      background-image: -webkit-gradient(linear, 50% 0%, 50% 100%, color-stop(0%, rgba(50, 50, 50, 1)), color-stop(100%, rgba(0, 0, 0, 0)));
      background-image: -webkit-linear-gradient(rgba(50, 50, 50, 1),rgba(0, 0, 0, 0));
      background-image: -moz-linear-gradient(rgba(50, 50, 50, 1),rgba(0,0,0,0));
      background-image: -o-linear-gradient(rgba(50, 50, 50, 1),rgba(0,0,0,0));
      background-image: linear-gradient(rgba(50, 50, 50, 1),rgba(0, 0, 0, 0));
    }
    .nano:after {
      content: '';
      position: absolute;
      z-index: 2;
      bottom: 4em;
      left: 0;
      right: 4.5em;
      height: 20px;
      background-image: -webkit-gradient(linear, 50% 0%, 50% 100%, color-stop(0%, rgba(0, 0, 0, 0)), color-stop(100%, rgba(50, 50, 50, 1)));
    background-image: -webkit-linear-gradient(rgba(0, 0, 0, 0),rgba(50, 50, 50, 1));
    background-image: -moz-linear-gradient(rgba(0,0,0,0),rgba(50, 50, 50, 1));
    background-image: -o-linear-gradient(rgba(0,0,0,0),rgba(50, 50, 50, 1));
    background-image: linear-gradient(rgba(0, 0, 0, 0),rgba(50, 50, 50, 1));
    }*/
    .nano > .nano-content:focus {
      outline: none;
    }
    .nano > .nano-content::-webkit-scrollbar {
      visibility: hidden;
    }
    .has-scrollbar > .nano-content::-webkit-scrollbar {
      visibility: visible;
    }
    .nano > .nano-pane {
      background : rgba(255,255,255,.1);
      position   : absolute;
      z-index: 5;
      width      : 1em;
      right      : 1.5em;
      top        : 2em;
      bottom     : 2em;
      visibility : hidden\9; /* Target only IE7 and IE8 with this hack */
      opacity    : .01;
      -webkit-transition    : .2s;
      -moz-transition       : .2s;
      -o-transition         : .2s;
      transition            : .2s;
    }
    .nano > .nano-pane > .nano-slider {
      background: #fff;
      background: rgba(255,255,255,.5);
      position              : relative;
      margin                : 0 1px;
    }
    .nano:hover > .nano-pane, .nano-pane.active, .nano-pane.flashed {
      visibility : visible\9; /* Target only IE7 and IE8 with this hack */
      opacity    : 0.99;
    }

    </style>

    <template if="{{!!I_ID}}">
      <ps-image-service id="service-image" image="{{image}}" type="card" I_ID='{{I_ID}}' extends="{{extends}}"></ps-image-service>
    </template>

    <template if="{{!!image}}">
      <template if="{{!user}}">
        <ps-user-service id="service-user" user="{{user}}" U_ID='{{image.owner_id}}'></ps-user-service>
      </template>

      <div class="tray" data-offscreen?="{{!tray}}">
        <article id="scrolling" class="nano">
          <div class="nano-content">
            <ps-image-iptc image="{{image}}" user="{{user}}"></ps-image-iptc>
            <ps-share image="{{image}}" user="{{user}}"></ps-share>
            <ps-image-exif image="{{image}}"></ps-image-exif>
            <ps-image-buy image="{{image}}" user="{{user}}" if="{{!!image.Image.Profile.length}}"></ps-image-buy>
          </div>
        </article>
        <nav>
          <button on-tap="{{changeTab}}" class="{{showing}}" data-tab="iptc"></button>
          <button on-tap="{{changeTab}}" class="{{showing}}" data-tab="share"></button>
          <button on-tap="{{changeTab}}" class="{{showing}}" data-tab="exif"></button>
          <button on-tap="{{changeTab}}" class="{{showing}}" data-tab="buy" if="{{!!image.Image.Profile.length}}"></button>
        </nav>
      </div>
      <ps-image-bkg image="{{image}}"></ps-image-bkg>
    </template>

    <button  on-tap="{{toggle}}" class="toggle"></button>
    
  </template>

  <script>
  Polymer('ps-image-card',{
    observe: {
      showing: 'setScroll'
    },
    created: function() {
      this.user = false;
      this.showing = 'iptc';
      this.tray = false;
      this.extends = [
        "ImageLink",
        "Iptc",
        "Profile",
        "Exif"
      ];
    },
    trayChanged: function(oldVal, newVal) {
      if (oldVal === true) return;
      $(this.shadowRoot.getElementById('scrolling')).nanoScroller({iOSNativeScrolling:true});
    },
    changeTab: function(event) {
      this.showing = event.currentTarget.dataset.tab;
    },
    setScroll: function(oldVal, newVal) {
      var target = (newVal === 'share') ? 'ps-' : 'ps-image-';
      $(this.shadowRoot.getElementById('scrolling')).find('[image]').hide();
      $(this.shadowRoot.getElementById('scrolling')).find(target+newVal).show();
      $(this.shadowRoot.getElementById('scrolling')).nanoScroller({iOSNativeScrolling:true});
    },
    toggle: function(oldVal, newVal) {
      this.tray = !this.tray;
      if (this.tray) {
        this.setScroll(this.showing, this.showing);
      }
    }
  });
  </script>
</polymer-element>
